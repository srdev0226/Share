var pacUrl="",userId="",userPassword="",pacData="",urlsArr=[];function getAllMatchesFromPac(){const e=pacData.match(/shExpMatch\(host, "(.*?)"/g);if(null!==e){for(i=0;i<e.length;i++){var r=e[i].replace('shExpMatch(host, "',"").replace('"',"");urlsArr.push(r)}console.log("urlsArr",urlsArr)}}function compareTwoHostNames(e,r){var a=e.split("."),t=r.split("."),s=a.length;s<t.length&&(s=t.length);for(var c=!1,o=!1,n=0,l=1;l<=s;l++){if("*"===a[a.length-l]&&1<l&&!c)return!0;if("*"===a[a.length-l]&&1===l&&(c=!0),!c&&a[a.length-l]!==t[t.length-l])return!1;if(o){if("*"===a[a.length-l+n])return!0;if(a[a.length-l+n]!==t[t.length-l])return!1}c&&!o&&a[a.length-2]===t[t.length-l]&&(o=!0,n=l-2)}return!c}function checkIfMatchedURL(e){var{hostname:r}=new URL(e);for(console.log(">>> checkIfMatchedURL(), url: ",r),i=0;i<urlsArr.length;i++)if(compareTwoHostNames(urlsArr[i],r))return console.log(">>> checkIfMatchedURL(), compareTwoHostNames() is true TTTTTTTTTTTTTTTTT"),!0;return console.log(">>> checkIfMatchedURL(), compareTwoHostNames() is false FFFFFFFFFFFFFFFF"),!1}function setPacProxy(){var e={mode:"pac_script",pacScript:{}};if(!pacData)return e={mode:"direct"},chrome.proxy.settings.set({value:e,scope:"regular"},function(){}),void console.log(">>> setPacProxy(), cleared proxy setting, set to direct mode");e.pacScript.data=pacData,getAllMatchesFromPac(),chrome.proxy.settings.set({value:e,scope:"regular"},function(){console.log(">>> setPacProxy() -> chrome.webRequest.onBeforeSendHeaders.addListener()"),chrome.webRequest.onBeforeSendHeaders.addListener(modifyRequestHeaderHandler_,{urls:["<all_urls>"]},["requestHeaders","blocking","extraHeaders"])})}const decipher=r=>{var a=e=>(()=>r.split("").map(e=>e.charCodeAt(0)))().reduce((e,r)=>e^r,e);return e=>e.match(/.{1,2}/g).map(e=>parseInt(e,16)).map(a).map(e=>String.fromCharCode(e)).join("")},myDecipher=decipher("ssproject");function getPac(e){var r=new XMLHttpRequest,a="";r.open("GET",e,!0),r.onreadystatechange=function(){4==r.readyState&&200==r.status&&(a=r.responseText);try{pacData=myDecipher(a)}catch(e){pacData=a}return setPacProxy(),a},r.send(null)}function pacProxy(){userPassword=userId=pacUrl="",chrome.storage.local.get(["pacUrl","userId","userPassword"],function(e){null!=e.pacUrl&&(pacUrl=e.pacUrl),null!=e.userId&&(userId=e.userId),null!=e.userPassword&&(userPassword=e.userPassword),0<pacUrl.length&&0<userId.length&&0<userPassword.length&&getPac(pacUrl)})}function modifyRequestHeaderHandler_(e){try{checkIfMatchedURL(e.url)&&(e.requestHeaders.push({name:"ssextraheader01",value:userId}),e.requestHeaders.push({name:"ssextraheader02",value:userPassword}))}catch(e){}return{requestHeaders:e.requestHeaders}}pacProxy(),console.log(">>> after pacProxy()");